<!doctype html>
<html>
<head>
    <title>Essential JS 1 : Label</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
    <link href="../content/bootstrap.min.css" rel="stylesheet" />
    <link href="../content/ejthemes/default-theme/ej.web.all.min.css" rel="stylesheet" />
    <link href="../content/default.css" rel="stylesheet" />
    <link href="../content/default-responsive.css" rel="stylesheet" />
    <!--[if lt IE 9]>
         <script src="../scripts/jquery-1.11.3.min.js" type="text/javascript"></script>
     <!--<![endif]-->
    <!--[if gte IE 9]><!-->
    <script src="../scripts/jquery-3.4.1.min.js" type="text/javascript"></script>
    <!--<![endif]-->
    <script src="../scripts/jsrender.min.js"></script>
    <script src="../scripts/diagramscripts/LabelDropdown.js"></script>
    <script src="../scripts/ej.web.all.min.js"></script>
    <script src="../scripts/properties.js" type="text/javascript"></script>
</head>
<body>
    <div class="content-container-fluid">
        <div class="row">
            <div class="cols-sample-area">
                <div id="diagram"></div>
            </div>
            <div id="sampleProperties">
                <div class="prop-grid">
                    <div class="row">
                        <div class="col-md-3">
                            Label Collection
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="labelcollection" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            OffsetX
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="offsetX" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            OffsetY
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="offsetY" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Rotate Angle
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="rotateAngle" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Font Color
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="fontcolor" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Font Size
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="fontsize" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Font Family
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="fontfamily" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Horizontal Alignment
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="horizontalalignment" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Vertical Alignment
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="verticalalignment" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Text Decoration
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="textdecoration" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Text Wrapping
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="textwrapping" />
                        </div>
                    </div>
                    <div class="row hideNewText">
                        <div class="col-md-3" id="textcontainer">
                            Text
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="text" style="width: 130px;" />
                        </div>
                    </div>
                    <div class="row hideNewText">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-3">
                            <input type="button" id="submit" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">

        var FlowShapes = ej.datavisualization.Diagram.FlowShapes;
        var NodeConstraints = ej.datavisualization.Diagram.NodeConstraints;

        var nodes = [
             {
                 name: "node1", width: 60, height: 30, offsetX: 280, offsetY: 85, labels: [{ "text": "Start" }],
                 shape: FlowShapes.Terminator, ports: [{ offset: { x: 0.5, y: 1 }, name: "n1aport" }]
             },
             {
                 name: "node2", width: 120, height: 60, offsetX: 280, offsetY: 205, labels: [{ "text": "Process" }],
                 shape: FlowShapes.Process,
                 ports: [
                     { offset: { x: 0, y: 0.5 }, name: "n2aport" },
                     { offset: { x: 0.5, y: 0 }, name: "n2bport" },
                     { offset: { x: 1, y: 0.5 }, name: "n2cport" },
                     { offset: { x: 0.5, y: 1 }, name: "n2dport" }
                 ]
             },
             {
                 name: "node3", width: 120, height: 60, offsetX: 530, offsetY: 205, labels: [{ text: "Decision" }],
                 shape: FlowShapes.Decision,
                 ports: [
                     { offset: { x: 0, y: 0.5 }, name: "n3aport" },
                     { offset: { x: 0.5, y: 1 }, name: "n3bport" }
                 ]
             },
             {
                 name: "node4", width: 120, height: 60, offsetX: 280, offsetY: 380, labels: [{ "text": "Process" }],
                 shape: FlowShapes.Process,
                 ports: [
                     { offset: { x: 0, y: 0.5 }, name: "n4aport" },
                     { offset: { x: 0.5, y: 0 }, name: "n4bport" },
                     { offset: { x: 1, y: 0.5 }, name: "n4cport" },
                     { offset: { x: 0.5, y: 1 }, name: "n4dport" }
                 ]
             },
             {
                 name: "node5", width: 60, height: 30, offsetX: 280, offsetY: 500, labels: [{ "text": "End" }],
                 shape: FlowShapes.Terminator,
                 ports: [
                     { offset: { x: 0.5, y: 0 }, name: "n5aport" }
                 ]
             },
             {
                 name: "node6", width: 120, height: 60, offsetX: 80, offsetY: 300, labels: [{ text: "Decision" }],
                 shape: FlowShapes.Decision,
                 ports: [
                     { offset: { x: 0.5, y: 0 }, name: "n6aport" },
                     { offset: { x: 0.5, y: 1 }, name: "n6bport" }
                 ]
             },
             {
                 name: "node7", width: 120, height: 60, offsetX: 530, offsetY: 380, labels: [{ "text": "Decision" }],
                 shape: FlowShapes.Document,
                 ports: [
                     { offset: { x: 0.5, y: 0 }, name: "n7aport" },
                     { offset: { x: 0, y: 0.5 }, name: "n7bport" }
                 ]
             }
        ];
        var connectors = [
             {
                 name: "connector1", sourceNode: "node1", targetNode: "node2", sourcePort: "n1aport", targetPort: "n2bport",
                 segments: [{ "type": "straight" }]
             },
             { name: "connector2", sourceNode: "node2", targetNode: "node3", sourcePort: "n2cport", targetPort: "n3aport" },
             { name: "connector3", sourceNode: "node2", targetNode: "node6", sourcePort: "n2aport", targetPort: "n6aport" },
             { name: "connector4", sourceNode: "node6", targetNode: "node4", sourcePort: "n6bport", targetPort: "n4aport" },
             {
                 name: "connector5", sourceNode: "node2", targetNode: "node4", sourcePort: "n2dport", targetPort: "n4bport",
                 segments: [{ "type": "straight" }]
             },
             { name: "connector6", sourceNode: "node4", targetNode: "node5", sourcePort: "n4dport", targetPort: "n5aport" },
             { name: "connector7", sourceNode: "node3", targetNode: "node7", sourcePort: "n3bport", targetPort: "n7aport" },
             { name: "connector8", sourceNode: "node7", targetNode: "node4", sourcePort: "n7bport", targetPort: "n4cport" }
        ];

        $(function () {

            $("#diagram").ejDiagram({
                height: "600px",
                width: "100%",
                nodes: nodes, connectors: connectors,
                pageSettings: { scrollLimit: "diagram" },
                defaultSettings: {
                    node: { borderColor: "#179B89", type:"flow", constraints: NodeConstraints.Default | NodeConstraints.CrispEdges },
                    connector: { segments: [{ "type": "orthogonal" }] },
                },
                selectionChange: selectionChange,
            });

            $("#fontsize").ejNumericTextbox({
                value: 12,
                enabled: false,
                width: "130px",
                cssClass: "fontSize",
                "change": propertyChange
            });

            $("#submit").ejButton({
                text: "Add",
                width: "50px",
                click: addnewlabel,
            });

            $("#offsetX").ejNumericTextbox({
                value: 0.5,
                decimalPlaces: 1,
                enabled: false,
                minValue: 0,
                maxValue: 1,
                incrementStep: 0.1,
                width: "130px",
                cssClass: "offsetX",
                "change": propertyChange
            });

            $("#offsetY").ejNumericTextbox({
                enabled: false,
                value: 0.5,
                minValue: 0,
                maxValue: 1,
                incrementStep: 0.1,
                decimalPlaces: 1,
                width: "130px",
                cssClass: "offsetY",
                "change": propertyChange
            });

            $("#rotateAngle").ejNumericTextbox({
                value: 0,
                enabled: false,
                width: "130px",
                cssClass: "rotateAngle",
                "change": propertyChange
            });

            $("#fontcolor").ejDropDownList({
                text: "Black",
                dataSource: FontColor,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "fontColor",
                "change": propertyChange
            });

            $("#horizontalalignment").ejDropDownList({
                text: "Center",
                dataSource: HorizontalAlignment,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "horizontalAlignment",
                "change": propertyChange
            });

            $("#verticalalignment").ejDropDownList({
                text: "Center",
                dataSource: VerticalAlignment,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "verticalAlignment",
                "change": propertyChange
            });

            $("#textwrapping").ejDropDownList({
                text: "WrapWithOverflow",
                dataSource: Wrapping,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "wrapping",
                "change": propertyChange
            });

            $("#textdecoration").ejDropDownList({
                text: "None",
                dataSource: Decoration,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "textDecoration",
                "change": propertyChange
            });

            $("#labelcollection").ejDropDownList({
                enabled: false,
                width: "130px",
                watermarkText: "labelName",
                "change": function (args) {
                    if (args.value == "newLabel")
                        addnewlabelbinding();
                    else {
                        var index = $('#labelcollection').ejDropDownList("instance").value();
                        binding(diagram.selectionList[0].labels[Number(index)]);
                        $(".hideNewText").css("display", "none");
                    }
                }
            });

            $("#fontfamily").ejDropDownList({
                text: "Arial",
                dataSource: FontFamily,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "fontFamily",
                "change": propertyChange
            });

            $(".hideNewText").css("display", "none");

            function propertyChange(args) {
                var index = $('#labelcollection').ejDropDownList("instance").value();
                var option = {};
                switch (args.model.cssClass) {
                    case "offsetX":
                        option.offset = { x: args.value };
                        break;
                    case "offsetY":
                        option.offset = { y: args.value };
                        break;
                    case "rotateAngle":
                        option.rotateAngle = args.value;
                        break;
                    case "fontColor":
                        option.fontColor = args.value;
                        break;
                    case "fontSize":
                        option.fontSize = args.value;
                        break;
                    case "fontFamily":
                        option.fontFamily = args.value;
                        break;
                    case "horizontalAlignment":
                        option.horizontalAlignment = args.value;
                        break;
                    case "verticalAlignment":
                        option.verticalAlignment = args.value;
                        break;
                    case "textDecoration":
                        option.textDecoration = args.value;
                        break;
                    case "wrapping":
                        option.wrapping = args.value;
                        break;
                }
                if (option && index && index != "newLabel")
                    diagram.updateLabel(diagram.selectionList[0].name, diagram.selectionList[0].labels[Number(index)], option);
            }

            function enabledisable(value) {
                $("#fontsize").ejNumericTextbox(value);
                $("#offsetX").ejNumericTextbox(value);
                $("#offsetY").ejNumericTextbox(value);
                $("#rotateAngle").ejNumericTextbox(value);
                $("#fontcolor").ejDropDownList(value);
                $("#horizontalalignment").ejDropDownList(value);
                $("#verticalalignment").ejDropDownList(value);
                $("#textdecoration").ejDropDownList(value);
                $("#textwrapping").ejDropDownList(value);
                $("#fontfamily").ejDropDownList(value);
                $("#labelcollection").ejDropDownList(value);
            }

            function selectionChange(args) {
                enabledisable("disable");
                if (args.state === "changed" && args.element && args.element.type != "connector" && args.changeType === "insert") {
                    dropdownlist();
                    enabledisable("enable");
                }
                $(".hideNewText").css("display", "none");
            }

            function dropdownlist() {
                var labelcollection = []; var node = diagram.selectionList[0];
                if (node && node.labels.length) {
                    for (var i = 0; i < node.labels.length; i++) {
                        labelcollection.push({ "text": node.labels[i].name, "value": i });
                    }
                    labelcollection.push({ "text": "newLabel", "value": "newLabel" });
                }
                $('#labelcollection').ejDropDownList({
                    dataSource: labelcollection,
                });
                var target = $('#labelcollection').data("ejDropDownList");
                target.option({ selectedIndex: 0 });
            }

            function binding(labels) {
                $("#fontsize").ejNumericTextbox({ value: labels.fontSize });
                $("#offsetX").ejNumericTextbox({ value: labels.offset.x });
                $("#offsetY").ejNumericTextbox({ value: labels.offset.y });
                $("#rotateAngle").ejNumericTextbox({ value: labels.rotateAngle });
                $("#fontcolor").ejDropDownList({ value: labels.fontColor });
                $("#horizontalalignment").ejDropDownList({ value: labels.horizontalAlignment });
                $("#verticalalignment").ejDropDownList({ value: labels.verticalAlignment });
                $("#textdecoration").ejDropDownList({ value: labels.textDecoration });
                $("#textwrapping").ejDropDownList({ value: labels.wrapping });
                $("#fontfamily").ejDropDownList({ value: labels.fontFamily });
            }

            function addnewlabelbinding() {
                var labels = ej.datavisualization.Diagram.LabelDefaults;
                binding(labels);
                $(".hideNewText").css("display", "block");
            }

            function addnewlabel() {
                var rotateAngle = Number(document.getElementById("rotateAngle").value);
                var fontColor = document.getElementById("fontcolor").value;
                var fontSize = Number(document.getElementById("fontsize").value);
                var fontFamily = document.getElementById("fontfamily").value;
                var horizontalAlignment = document.getElementById("horizontalalignment").value;
                var offsetX = Number(document.getElementById("offsetX").value);
                var offsetY = Number(document.getElementById("offsetY").value);
                var verticalAlignment = document.getElementById("verticalalignment").value;
                var textDecoration = document.getElementById("textdecoration").value;
                var wrapping = document.getElementById("textwrapping").value;
                var text = document.getElementById("text").value;
                var label = {
                    name: "label" + ej.datavisualization.Diagram.Util.randomId(), horizontalAlignment: horizontalAlignment, verticalAlignment: verticalAlignment,
                    rotateAngle: rotateAngle, fontColor: fontColor, fontSize: fontSize, fontFamily: fontFamily, offset: { x: offsetX, y: offsetY }, textDecoration: textDecoration,
                    wrapping: wrapping, text: text,
                };
                diagram.addLabel(diagram.selectionList[0].name, label);
                dropdownlist();
                $(".hideNewText").css("display", "none");
            }

            $("#sampleProperties").ejPropertiesPanel();
            var diagram = $("#diagram").ejDiagram("instance");
        });
    </script>
    <style>
        .row .cols-sample-area {
            width: 67%;
        }

        .row .cols-prop-area {
            width: 31%;
        }
    </style>
</body>
</html>
