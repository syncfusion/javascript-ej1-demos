<!doctype html>
<html>
<head>
    <title>Essential JS 1 : Port</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="utf-8">
    <link href="../content/bootstrap.min.css" rel="stylesheet" />
    <link href="../content/ejthemes/default-theme/ej.web.all.min.css" rel="stylesheet" />
    <link href="../content/default.css" rel="stylesheet" />
    <link href="../content/default-responsive.css" rel="stylesheet" />
    <!--[if lt IE 9]>
        <script src="../scripts/jquery-1.11.3.min.js" type="text/javascript"></script>
    <!--<![endif]-->
    <!--[if gte IE 9]><!-->
    <script src="../scripts/jquery-3.4.1.min.js" type="text/javascript"></script>
    <!--<![endif]-->
    <script src="../scripts/jsrender.min.js"></script>
    <script src="../scripts/ej.web.all.min.js"></script>
    <script src="../scripts/properties.js" type="text/javascript"></script>
</head>
<body>
    <div class="content-container-fluid">
        <div class="row">
            <div class="cols-sample-area">
                <div id="diagram"></div>
            </div>
            <div id="sampleProperties">
                <div class="prop-grid">
                    <div class="row">
                        <div class="col-md-3">
                            Port Collection
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="portcollection" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Visibility
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="visibility" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            OffsetX
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="offsetX" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            OffsetY
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="offsetY" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Border Width
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="borderwidth" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Size
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="portsize" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Fill Color
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="background" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Border Color
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="backgroundborder" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            Shape
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="portshape" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            ActiveTool
                        </div>
                        <div class="col-md-3">
                            <input type="text" id="setTool" />
                        </div>
                    </div>
                    <div class="row" id="submitDiv" style="display: none">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-3">
                            <input type="button" id="submit" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">

        $(function () {

            var FlowShapes = ej.datavisualization.Diagram.FlowShapes;
            var PortVisibility = ej.datavisualization.Diagram.PortVisibility;

            var nodes = [
                {
                    name: "node1", width: 60, height: 30, offsetX: 280, offsetY: 85, labels: [{ "text": "Start" }], shape: FlowShapes.Terminator,
                    ports: [
                        addPort("n1aport", 0.5, 1)
                    ]
                },
                {
                    name: "node2", offsetX: 280, offsetY: 205, labels: [{ "text": "Process" }], shape: FlowShapes.Process,
                    ports: [
                        addPort("n2aport", 0, 0.5),
                        addPort("n2bport", 0.5, 0, "circle"),
                        addPort("n2cport", 1, 0.5),
                        addPort("n2dport", 0.5, 1, "path")
                    ]
                },
                {
                    name: "node3", offsetX: 530, offsetY: 205, labels: [{ text: "Decision" }], shape: FlowShapes.Decision,
                    ports: [
                        addPort("n3aport", 0, 0.5),
                        addPort("n3bport", 0.5, 1)
                    ]
                },
                {
                    name: "node4", offsetX: 280, offsetY: 380, labels: [{ "text": "Process1" }], shape: FlowShapes.Process,
                    ports: [
                        addPort("n4aport", 0, 0.5, "x"),
                        addPort("n4bport", 0.5, 0, "circle"),
                        addPort("n4cport", 1, 0.5, "path"),
                        addPort("n4dport", 0.5, 1)
                    ]
                },
                {
                    name: "node5", width: 60, height: 30, offsetX: 280, offsetY: 500, labels: [{ "text": "End" }], shape: FlowShapes.Terminator,
                    ports: [
                        addPort("n5aport", 0.5, 0)
                    ]
                },
                {
                    name: "node6", offsetX: 80, offsetY: 300, labels: [{ text: "Decision" }], shape: FlowShapes.Decision,
                    ports: [
                        addPort("n6aport", 0.5, 0),
                        addPort("n6bport", 0.5, 1)
                    ]
                },
                {
                    name: "node7", offsetX: 530, offsetY: 380, labels: [{ "text": "Decision" }], shape: FlowShapes.Document,
                    ports: [
                        addPort("n7aport", 0.5, 0),
                        addPort("n7bport", 0, 0.5)
                    ]
                },
            ];

            var connectors = [
                { name: "connector1", sourceNode: "node1", targetNode: "node2", sourcePort: "n1aport", targetPort: "n2bport", segments: [{ "type": "straight" }] },
                { name: "connector2", sourceNode: "node2", targetNode: "node3", sourcePort: "n2cport", targetPort: "n3aport" },
                { name: "connector3", sourceNode: "node2", targetNode: "node6", sourcePort: "n2aport", targetPort: "n6aport" },
                { name: "connector4", sourceNode: "node6", targetNode: "node4", sourcePort: "n6bport", targetPort: "n4aport" },
                { name: "connector5", sourceNode: "node2", targetNode: "node4", sourcePort: "n2dport", targetPort: "n4bport", segments: [{ "type": "straight" }] },
                { name: "connector6", sourceNode: "node4", targetNode: "node5", sourcePort: "n4dport", targetPort: "n5aport" },
                { name: "connector7", sourceNode: "node3", targetNode: "node7", sourcePort: "n3bport", targetPort: "n7aport" },
                { name: "connector8", sourceNode: "node7", targetNode: "node4", sourcePort: "n7bport", targetPort: "n4cport" }
            ];

            $("#diagram").ejDiagram({
                height: "600px", width: "100%",
                nodes: nodes, connectors: connectors,
                setTool: function (args) {
                    var value = document.getElementById("setTool").value;
                    if (value === "drag") {
                        args.action = ej.datavisualization.Diagram.ActiveTool.Drag;
                    }
                    else if (value === "draw") {
                        args.action = ej.datavisualization.Diagram.ActiveTool.Draw;
                    }
                },
                pageSettings: { scrollLimit: "diagram" },
                selectionChange: selectionChange,
                defaultSettings: {
                    node: { type: "flow", width: 120, height: 60 },
                    connector: { segments: [{ "type": "orthogonal" }] },
                }
            });

            $("#offsetX").ejNumericTextbox({
                value: 0,
                decimalPlaces: 1,
                minValue: 0,
                maxValue: 1,
                incrementStep: 0.1,
                enabled: false,
                cssClass: "offsetX",
                width: "130px",
                "change": propertyChange
            });

            $("#offsetY").ejNumericTextbox({
                enabled: false,
                value: 0,
                decimalPlaces: 1,
                minValue: 0,
                maxValue: 1,
                incrementStep: 0.1,
                width: "130px",
                cssClass: "offsetY",
                "change": propertyChange
            });

            $("#submit").ejButton({
                text: "Add",
                width: "50px",
                click: addnewport,
                showRoundedCorner: true
            });

            var portVisibility = [{ text: "Visible", value: 1 }, { text: "Hidden", value: 2 }, { text: "Hover", value: 4 }, { text: "Connect", value: 8 }];
            $("#visibility").ejDropDownList({
                enabled: false,
                text: "Connect",
                dataSource: portVisibility,
                showCheckbox: true,
                fields: { value: "value", text: "text" },
                width: "130px",
                cssClass: "visibility",
                change: propertyChange
            });

            $("#borderwidth").ejNumericTextbox({
                value: 1,
                enabled: false,
                width: "130px",
                minValue: 1,
                cssClass: "borderWidth",
                "change": propertyChange
            });

            $("#portsize").ejNumericTextbox({
                value: 8,
                enabled: false,
                width: "130px",
                minValue: 8,
                cssClass: "size",
                "change": propertyChange
            });

            var FillColor = [{ text: "White", value: "white" }, { text: "#1a1a1a", value: "#1a1a1a" }, { text: "#E4B123", value: "#E4B123" }, { text: "#F05023", value: "#F05023" }, { text: "#3CB549", value: "#3CB549" }, { text: "#D572AD", value: "#D572AD" }, { text: "Black", value: "black" }, { text: "Goldenrod", value: "goldenrod" }, { text: "Indigo", value: "indigo" }, { text: "Chocolate", value: "chocolate" }, { text: "DarkGoldenRod", value: "darkgoldenrod" }, { text: "FireBrick", value: "firebrick" }, { text: "DarkRed", value: "darkred" }];
            $("#background").ejDropDownList({
                text: "White",
                dataSource: FillColor,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "fillColor",
                "change": propertyChange
            });

            $("#portcollection").ejDropDownList({
                enabled: false,
                width: "130px",
                watermarkText: "portName",
                "change": function (args) {
                    if (args.value == "newPort")
                        addnewportbinding();
                    else {
                        var index = $('#portcollection').ejDropDownList("instance").value();
                        binding(diagram.selectionList[0].ports[Number(index)]);
                        $("#submitDiv").css("display", "none");
                    }
                }
            });

            var portShapes = [{ text: "Square", value: "square" }, { text: "Circle", value: "circle" }, { text: "X", value: "x" }, { text: "Path", value: "path" }];
            $("#portshape").ejDropDownList({
                text: "Square",
                dataSource: portShapes,
                fields: { value: "value", text: "text" },
                width: "130px",
                enabled: false,
                cssClass: "shape",
                "change": propertyChange
            });
            //setTool drop down list button
            var setTool = [{ text: "None", value: "none" }, { text: "Drag", value: "drag" }, { text: "Draw", value: "draw" }];
            $("#setTool").ejDropDownList({
                text: "None",
                enabled: false,
                dataSource: setTool,
                fields: { value: "value", text: "text" },
                width: "130px",
                cssClass: "setTool",
                "change": propertyChange
            });

            $("#backgroundborder").ejDropDownList({
                text: "#1a1a1a",
                dataSource: FillColor,
                fields: { value: "value", text: "text" },
                enabled: false,
                width: "130px",
                cssClass: "borderColor",
                "change": propertyChange
            });

            function addPort(name, offsetX, offsetY, shape) {
                var port = {};
                port.name = name;
                port.offset = { x: offsetX, y: offsetY };
                port.visibility = PortVisibility.Visible;
                port.constraints = ej.datavisualization.Diagram.PortConstraints.Connect | ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag;
                if (shape)
                    port.shape = shape;
                if (shape === "circle")
                    port.borderColor = "#E4B123";
                else if (shape === "x")
                    port.borderColor = "#F05023";
                else if (shape === "path") {
                    port.fillColor = port.borderColor = "#3CB549";
                    port.pathData = "M6.805,0L13.61,10.703L0,10.703z";
                }
                else
                    port.borderColor = "#D572AD";
                port.connectorPadding = 4;
                return port;
            }
            var isBinding = false;
            function propertyChange(args) {
                if (!isBinding) {
                    var index = $('#portcollection').ejDropDownList("instance").value();
                    var option = {};
                    switch (args.model.cssClass) {
                        case "offsetX":
                            option.offset = { x: args.value };
                            break;
                        case "offsetY":
                            option.offset = { y: args.value };
                            break;
                        case "visibility":
                            option.visibility = args.value;
                            break;
                        case "borderWidth":
                            option.borderWidth = args.value;
                            break;
                        case "size":
                            option.size = args.value;
                            break;
                        case "fillColor":
                            option.fillColor = args.value;
                            break;
                        case "shape":
                            option.shape = args.value;
                            if (option.shape === "path" && index && index != "newPort") {
                                var port = diagram.selectionList[0].ports[Number(index)];
                                port.pathData = "M6.805,0L13.61,10.703L0,10.703z";
                            }
                            break;
                        case "borderColor":
                            option.borderColor = args.value;
                            break;
                    }
                    if (args.model.cssClass != "setTool" && option && index && index != "newPort") {
                        var port = diagram.selectionList[0].ports[Number(index)];
                        if (option.visibility) {
                            if (args.isChecked) {
                                option.visibility = port.visibility | option.visibility;
                            }
                            else {
                                option.visibility = port.visibility & ~option.visibility;
                            }
                        }
                        diagram.updatePort(diagram.selectionList[0].name, port, option);
                    }
                    else diagram.clearSelection();
                }
            }
            function enabledisable(value) {
                $("#offsetX").ejNumericTextbox(value);
                $("#offsetY").ejNumericTextbox(value);
                $("#borderwidth").ejNumericTextbox(value);
                $("#portsize").ejNumericTextbox(value);
                $("#background").ejDropDownList(value);
                $("#backgroundborder").ejDropDownList(value);
                $("#setTool").ejDropDownList(value);
                $("#portshape").ejDropDownList(value);
                $("#visibility").ejDropDownList(value);
                $("#portcollection").ejDropDownList(value);
            }
            function selectionChange(args) {
                enabledisable("disable");
                if (args.state === "changed" && args.element && args.element.type != "connector" && args.changeType === "insert") {
                    dropdownlist();
                    enabledisable("enable");
                }
                $("#submitDiv").css("display", "none");
            }
            function dropdownlist() {
                var portcollection = []; var node = diagram.selectionList[0];
                if (node && node.ports.length) {
                    for (var i = 0; i < node.ports.length; i++) {
                        portcollection.push({ "text": node.ports[i].name, "value": i });
                    }
                    portcollection.push({ "text": "newPort", "value": "newPort" });
                }
                $('#portcollection').ejDropDownList({
                    dataSource: portcollection,
                });
                var target = $('#portcollection').data("ejDropDownList");
                target.option({ selectedIndex: 0 });
            }
            function binding(ports) {
                isBinding = true;
                $("#offsetX").ejNumericTextbox({ value: ports.offset.x });
                $("#offsetY").ejNumericTextbox({ value: ports.offset.y });
                $("#portshape").ejDropDownList({ value: ports.shape });
                $("#visibility").ejDropDownList({ value: ports.visibility });
                $("#borderwidth").ejNumericTextbox({ value: ports.borderWidth });
                $("#background").ejDropDownList({ value: ports.fillColor });
                $("#backgroundborder").ejDropDownList({ value: ports.borderColor });
                $("#portsize").ejNumericTextbox({ value: ports.size });
                isBinding = false;
            }
            function addnewportbinding() {
                var ports = ej.datavisualization.Diagram.PortDefaults;
                binding(ports);
                $("#submitDiv").css("display", "block");
            }


            function addnewport() {
                var pathData;
                var borderWidth = Number(document.getElementById("borderwidth").value);
                var fillColor = document.getElementById("background").value;
                var PortSize = Number(document.getElementById("portsize").value);
                var PortShape = document.getElementById("portshape").value;
                var BorderColor = document.getElementById("backgroundborder").value;
                var offsetX = Number(document.getElementById("offsetX").value);
                var offsetY = Number(document.getElementById("offsetY").value);
                var visibility = document.getElementById("visibility").value;
                if (PortShape === "path")
                    pathData = "M6.805,0L13.61,10.703L0,10.703z";
                var port = [{
                    name: "port" + ej.datavisualization.Diagram.Util.randomId(), borderColor: BorderColor, borderWidth: borderWidth,
                    fillColor: fillColor, shape: PortShape, pathData: pathData ? pathData : "", size: PortSize, visibility: visibility, offset: { x: offsetX, y: offsetY }
                }];
                diagram.addPorts(diagram.selectionList[0].name, port);
                dropdownlist();
                $("#submitDiv").css("display", "none");
            }
            $("#sampleProperties").ejPropertiesPanel();
            var diagram = $("#diagram").ejDiagram("instance");
        });
    </script>
    <style>
        .row .cols-sample-area {
            width: 67%;
        }

        .row .cols-prop-area {
            width: 31%;
        }
    </style>
</body>
</html>
